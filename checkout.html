<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URBAN NUCLEUS | Secure Checkout</title>
    <script>window.API_BASE_URL = 'https://urbannucleus.in';</script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    
    <!-- Razorpay Payment Gateway Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        /* Checkout Page Specific Styles */
        .checkout-page {
            padding: 60px 0;
            background-color: #f8f5f0;
        }
        
        /* Professional Notification System */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10002;
            max-width: 400px;
        }
        
        /* Mobile responsive notifications */
        @media (max-width: 768px) {
            .notification-container {
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .notification {
                padding: 16px;
                margin-bottom: 12px;
            }
            
            .notification-title {
                font-size: 14px;
            }
            
            .notification-message {
                font-size: 13px;
            }
        }
        
        .notification {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            margin-bottom: 16px;
            padding: 20px;
            border-left: 4px solid #4caf50;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: #4caf50;
        }
        
        .notification.error {
            border-left-color: #f44336;
        }
        
        .notification.warning {
            border-left-color: #ff9800;
        }
        
        .notification.info {
            border-left-color: #2196f3;
        }
        
        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .notification-close:hover {
            background: #f5f5f5;
            color: #666;
        }
        
        .notification-message {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 0;
        }
        
        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: #4caf50;
            width: 100%;
            animation: notification-progress 5s linear forwards;
        }
        
        .notification.error .notification-progress {
            background: #f44336;
        }
        
        .notification.warning .notification-progress {
            background: #ff9800;
        }
        
        .notification.info .notification-progress {
            background: #2196f3;
        }
        
        @keyframes notification-progress {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        .notification-icon {
            font-size: 18px;
        }
        
        .notification.success .notification-icon {
            color: #4caf50;
        }
        
        .notification.error .notification-icon {
            color: #f44336;
        }
        
        .notification.warning .notification-icon {
            color: #ff9800;
        }
        
        .notification.info .notification-icon {
            color: #2196f3;
        }

        .checkout-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .checkout-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .checkout-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .checkout-header p {
            font-family: 'Poppins', sans-serif;
            color: #666;
        }

        .checkout-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            font-family: 'Poppins', sans-serif;
        }

        .checkout-step {
            padding: 0 20px;
            position: relative;
            color: #999;
        }

        .checkout-step.active {
            color: #000;
            font-weight: 500;
        }

        .checkout-step.completed {
            color: #000;
        }

        .checkout-step:not(:last-child):after {
            content: ">";
            position: absolute;
            right: -5px;
        }

        .checkout-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }

        .checkout-form {
            flex: 1;
            min-width: 300px;
        }

        .checkout-summary {
            width: 350px;
            background: #fff;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .form-section {
            background: #fff;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .form-section-title {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-family: 'Poppins', sans-serif;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .payment-methods {
            margin-top: 20px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method:hover {
            border-color: #000;
        }

        .payment-method.active {
            border-color: #000;
            background: #f8f8f8;
        }

        .payment-method input {
            margin-right: 15px;
        }

        .payment-method-icon {
            margin-right: 15px;
            font-size: 24px;
        }

        .payment-method-details {
            flex: 1;
        }

        .payment-method-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .payment-method-desc {
            font-family: 'Poppins', sans-serif;
            font-size: 12px;
            color: #666;
        }

        .summary-title {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .summary-item {
            display: flex;
            margin-bottom: 15px;
        }

        .summary-item-image {
            width: 70px;
            height: 90px;
            object-fit: cover;
            margin-right: 15px;
        }

        .summary-item-details {
            flex: 1;
        }

        .summary-item-title {
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .summary-item-price {
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            color: #666;
        }

        .summary-totals {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
        }

        .summary-total {
            font-weight: 600;
            font-size: 18px;
            margin: 20px 0;
        }

        .place-order-btn {
            width: 100%;
            padding: 15px;
            background: #000;
            color: #fff;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .place-order-btn:hover {
            background: #333;
        }

        .secure-checkout {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            font-family: 'Poppins', sans-serif;
            font-size: 12px;
            color: #666;
        }

        .secure-checkout i {
            margin-right: 8px;
            color: #4CAF50;
        }

        @media (max-width: 768px) {
            .checkout-content {
                flex-direction: column;
            }
            
            .checkout-summary {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        /* Loading State Styles */
        .loading-summary {
            text-align: center;
            padding: 40px 20px;
        }

        .loading-summary .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #333;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-summary p {
            color: #666;
            font-family: 'Poppins', sans-serif;
            margin: 0;
        }

        /* Empty State */
        .empty-summary {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-summary i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }

        .empty-summary p {
            margin-bottom: 15px;
            font-family: 'Poppins', sans-serif;
        }

        .empty-summary .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #333;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            transition: background 0.3s ease;
        }

        .empty-summary .btn:hover {
            background: #000;
        }

        /* Error State */
        .empty-summary .fa-exclamation-triangle {
            color: #ff6b6b;
        }

        /* Edit Order Button Styles */
        .btn-outline {
            background: transparent;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        .btn-outline:hover {
            background: #f8f8f8;
            border-color: #999;
        }

        .continue-shopping {
            display: inline-block;
            text-decoration: none;
            color: #666;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            margin-top: 15px;
            transition: color 0.3s ease;
        }

        .continue-shopping:hover {
            color: #333;
        }

        /* Button spacing and layout */
        #editOrderBtn, #addMoreProductsBtn {
            margin-top: 10px;
            width: 100%;
            padding: 12px 15px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        #editOrderBtn {
            margin-top: 15px;
        }

        #addMoreProductsBtn {
            margin-top: 10px;
        }

        /* Summary item enhancements */
        .summary-item {
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .summary-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        /* Image handling improvements */
        .summary-item-image {
            width: 70px;
            height: 90px;
            object-fit: cover;
            border-radius: 5px;
            background-color: #f8f9fa;
            border: 1px solid #eee;
        }

        .summary-item-image[src*="placeholder.svg"] {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
        }

        /* Image loading state */
        .summary-item-image:not([src]) {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
        }

        .summary-item-image:invalid {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
        }
        
        .tax-inclusive {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <!-- Announcement Bar -->
    <div id="announcement-bar" style="background: #000000; color: #ffffff; padding: 12px 0; position: fixed; top: 0; left: 0; right: 0; z-index: 10001; border-bottom: 2px solid #333; box-shadow: 0 2px 10px rgba(0,0,0,0.5); overflow: hidden; display: none;">
        <div class="marquee-content" style="display: flex; animation: marquee 25s linear infinite; white-space: nowrap; font-size: 14px; font-weight: 600; font-family: 'Poppins', sans-serif; color: #ffffff;">
            <!-- Content will be loaded dynamically from API -->
        </div>
    </div>

    <style>
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        body { padding-top: 120px; }
        .header { top: 50px; }

        /* Search Button in Header */
        .search-button-header {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: color 0.3s ease;
        }

        .search-button-header:hover {
            color: var(--text-primary);
        }

        /* Search Modal */
        .search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 10000;
        }

        .search-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-modal-content {
            background: white;
            border-radius: 12px;
            padding: 0;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .search-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
        }

        .search-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .close-search-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 4px;
            transition: color 0.3s ease;
        }

        .close-search-btn:hover {
            color: var(--text-primary);
        }

        .search-input-section {
            padding: 20px 24px;
            display: flex;
            gap: 12px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .perform-search-btn {
            background-color: var(--accent-gold);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        .perform-search-btn:hover {
            background-color: #d4af37;
        }

        .search-results-container {
            padding: 0 24px 24px;
        }

        .search-suggestions {
            margin-bottom: 20px;
        }

        .search-suggestions p {
            margin: 0 0 12px 0;
            font-weight: 500;
            color: var(--text-primary);
        }

        .suggestion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-btn {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .suggestion-btn:hover {
            background-color: var(--accent-gold);
            color: white;
            border-color: var(--accent-gold);
        }

        .search-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .search-result-item {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .search-result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .search-result-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .search-result-info {
            padding: 12px;
        }

        .search-result-name {
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .search-result-price {
            color: var(--accent-gold);
            font-weight: 600;
        }

        .search-no-results {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
    </style>

    <!-- Professional Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <a href="index.html">
                        <h1>URBAN NUCLEUS</h1>
                    </a>
                </div>

                <!-- Left Side Navigation -->
                <nav class="nav left-nav">
                    <ul class="nav-list">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="collections.html">Collections</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </nav>

                <!-- Right Side Icons -->
                <div class="header-icons">
                    <a href="login.html"><i class="fas fa-user"></i> Login</a>
                    <a href="signup.html"><i class="fas fa-user-plus"></i> Sign Up</a>
                    <button type="button" id="searchBtn" style="background: none; border: none; color: inherit; font-size: inherit; cursor: pointer; padding: 0;">
                        <i class="fas fa-search"></i>
                    </button>
                    <a href="cart.html" class="cart-icon"><i class="fas fa-shopping-bag"></i><span class="cart-count">2</span></a>
                </div>

                <div class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Modal -->
    <div id="searchModal" class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <h3>Search Products</h3>
                <button type="button" id="closeSearchBtn" class="close-search-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="search-input-section">
                <input type="text" id="searchInput" placeholder="Search for products..." class="search-input">
                <button type="button" id="performSearchBtn" class="perform-search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div id="searchResultsContainer" class="search-results-container">
                <div class="search-suggestions">
                    <p>Popular searches:</p>
                    <div class="suggestion-buttons">
                        <button type="button" class="suggestion-btn" data-query="sneakers">Sneakers</button>
                        <button type="button" class="suggestion-btn" data-query="watches">Watches</button>
                        <button type="button" class="suggestion-btn" data-query="bags">Bags</button>
                        <button type="button" class="suggestion-btn" data-query="nike">Nike</button>
                        <button type="button" class="suggestion-btn" data-query="adidas">Adidas</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <div class="mobile-menu-close">
            <i class="fas fa-times"></i>
        </div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="collections.html">Collections</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="signup.html">Sign Up</a></li>
        </ul>
    </div>

    <!-- Checkout Page Content -->
    <section class="checkout-page">
        <div class="checkout-container">
            <div class="checkout-header">
                <h2>Secure Checkout</h2>
                <p>Complete your purchase with confidence</p>
            </div>

            <div class="checkout-steps">
                <div class="checkout-step completed">
                    <a href="cart.html">Cart</a>
                </div>
                <div class="checkout-step active">
                    Information
                </div>
                <div class="checkout-step">
                    Shipping
                </div>
                <div class="checkout-step">
                    Payment
                </div>
            </div>

            <div class="checkout-content">
                <div class="checkout-form">
                    <form id="checkoutForm">
                        <!-- Contact Information -->
                        <div class="form-section">
                            <h3 class="form-section-title">Contact Information</h3>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox"> Keep me updated on news and exclusive offers
                                </label>
                            </div>
                        </div>

                        <!-- Shipping Address -->
                        <div class="form-section">
                            <h3 class="form-section-title">Shipping Address</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" id="address" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="apartment">Apartment, suite, etc. (optional)</label>
                                <input type="text" id="apartment" class="form-control">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="country">Country</label>
                                    <select id="country" class="form-control" required>
                                        <option value="">Select Country</option>
                                        <option value="IN">India</option>
                                        <option value="US">United States</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="CA">Canada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="state">State</label>
                                    <select id="state" class="form-control" required>
                                        <option value="">Select State</option>
                                        <option value="MH">Maharashtra</option>
                                        <option value="DL">Delhi</option>
                                        <option value="KA">Karnataka</option>
                                        <option value="TN">Tamil Nadu</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="zip">PIN Code</label>
                                    <input type="text" id="zip" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phone" class="form-control" required>
                            </div>
                        </div>

                        <!-- Shipping Method -->
                        <div class="form-section">
                            <h3 class="form-section-title">Shipping Method</h3>
                            <div class="payment-method active">
                                <input type="radio" name="shipping" id="standardShipping" checked>
                                <div class="payment-method-details">
                                    <div class="payment-method-title">Standard Shipping</div>
                                    <div class="payment-method-desc">Delivery in 5-7 business days</div>
                                </div>
                                <div class="payment-method-price">Free</div>
                            </div>
                            <div class="payment-method">
                                <input type="radio" name="shipping" id="expressShipping">
                                <div class="payment-method-details">
                                    <div class="payment-method-title">Express Shipping</div>
                                    <div class="payment-method-desc">Delivery in 2-3 business days</div>
                                </div>
                                <div class="payment-method-price">‚Çπ250</div>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section">
                            <h3 class="form-section-title">Payment Method</h3>
                            <div class="payment-methods">
                                <div class="payment-method active">
                                    <input type="radio" name="payment" id="razorpay" checked>
                                    <div class="payment-method-icon">
                                        <i class="fas fa-credit-card"></i>
                                    </div>
                                    <div class="payment-method-details">
                                        <div class="payment-method-title">Online Payment</div>
                                        <div class="payment-method-desc">Credit Card, Debit Card, UPI, Net Banking, Wallets ‚Ä¢ Free Delivery</div>
                                    </div>
                                    <div class="payment-method-badge">
                                        <span style="font-size: 10px; background: #3f51b5; color: white; padding: 2px 6px; border-radius: 3px;">SECURE</span>
                                    </div>
                                </div>
                                <div class="payment-method">
                                    <input type="radio" name="payment" id="cod">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <div class="payment-method-details">
                                        <div class="payment-method-title">Cash on Delivery (COD)</div>
                                        <div class="payment-method-desc">Pay ‚Çπ200 advance + remaining on delivery</div>
                                    </div>
                                </div>
                            </div>

                            <!-- COD Information (shown when COD is selected) -->
                            <div id="codInfo" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <i class="fas fa-info-circle" style="color: #007bff; margin-right: 10px; font-size: 18px;"></i>
                                    <strong style="color: #007bff;">Cash on Delivery Information</strong>
                                </div>
                                <ul style="margin: 0; padding-left: 20px; color: #555; font-size: 14px;">
                                    <li><strong>Advance Payment:</strong> ‚Çπ200 delivery charges must be paid online</li>
                                    <li><strong>Remaining Amount:</strong> Pay the product cost in cash when your order is delivered</li>
                                    <li><strong>Delivery:</strong> Standard delivery in 5-7 business days</li>
                                    <li><strong>Note:</strong> COD orders require advance payment of delivery charges only</li>
                                </ul>
                            </div>
                        </div>

                        <button type="submit" class="place-order-btn" id="placeOrderBtn">
                            <span class="btn-text">PLACE ORDER</span>
                            <span class="btn-loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Processing...
                            </span>
                        </button>
                        <div class="secure-checkout">
                            <i class="fas fa-lock"></i> Secure Checkout
                        </div>
                    </form>
                </div>

                <div class="checkout-summary">
                    <h3 class="summary-title">Order Summary</h3>
                    
                    <!-- Order Items - Dynamic Content -->
                    <div id="orderItems">
                        <!-- Products will be populated dynamically -->
                        <div class="loading-summary">
                            <div class="loading-spinner"></div>
                            <p>Loading order details...</p>
                        </div>
                    </div>
                    
                    <!-- Order Totals -->
                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="subtotal">‚Çπ0</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span id="shipping">Free Delivery</span>
                        </div>
                        <!-- COD Delivery Charges (shown when COD is selected) -->
                        <div class="summary-row" id="codChargesRow" style="display: none;">
                            <span>COD Delivery Charges (Advance)</span>
                            <span id="codCharges">‚Çπ200</span>
                        </div>
                        <div class="summary-row">
                            <span class="tax-inclusive">All prices inclusive of taxes</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total</span>
                            <span id="total">‚Çπ0</span>
                        </div>
                    </div>
                    
                    <a href="cart.html" class="continue-shopping">
                        <i class="fas fa-arrow-left"></i> Back to Cart
                    </a>
                    
                    <!-- Edit Order Button (shown when product data is available) -->
                    <button id="editOrderBtn" class="btn btn-outline" style="margin-top: 15px; width: 100%; padding: 10px; background: transparent; color: #333; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; display: none;">
                        <i class="fas fa-edit"></i> Edit Order
                    </button>
                    
                    <!-- Add More Products Button -->
                    <button id="addMoreProductsBtn" class="btn btn-outline" style="margin-top: 10px; width: 100%; padding: 10px; background: transparent; color: #333; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; display: none;">
                        <i class="fas fa-plus"></i> Add More Products
                    </button>
                    

                </div>
            </div>
        </div>
    </section>

         

    <script src="auth-state.js?v=1.0.11"></script>
    <script src="main.js?v=1.0.10"></script>
    <script>
        // Announcement Bar Functions
        async function loadAnnouncementBarData() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/announcement`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.visible && data.messages && data.messages.length > 0) {
                        updateAnnouncementBar(data.messages);
                        showAnnouncementBar();
                    } else {
                        hideAnnouncementBar();
                    }
                } else {
                    hideAnnouncementBar();
                }
            } catch (error) {
                console.error('Error loading announcement bar:', error);
                hideAnnouncementBar();
            }
        }

        function showAnnouncementBar() {
            const bar = document.getElementById('announcement-bar');
            if (bar) {
                bar.style.display = 'block';
                bar.classList.remove('hidden');
            }
        }

        function hideAnnouncementBar() {
            const bar = document.getElementById('announcement-bar');
            if (bar) {
                bar.style.display = 'none';
                bar.classList.add('hidden');
            }
        }

        function updateAnnouncementBar(messages) {
            const marqueeContent = document.querySelector('#announcement-bar .marquee-content');
            if (marqueeContent && messages.length > 0) {
                // Duplicate messages for seamless loop
                const duplicatedMessages = [...messages, ...messages];
                marqueeContent.innerHTML = duplicatedMessages.map(msg => 
                    `<span style="margin-right: 50px;">${msg}</span>`
                ).join('');
            } else {
                hideAnnouncementBar();
            }
        }

        // Load announcement bar on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAnnouncementBarData();
            // Refresh every 30 seconds
            setInterval(loadAnnouncementBarData, 30000);
        });

        // Utility function to safely resolve image paths
        function resolveImagePath(imagePath, fallbackPath = 'uploads/images/placeholder.svg') {
            try {
                // Handle case where imagePath is an object (from database)
                if (imagePath && typeof imagePath === 'object' && imagePath.image_url) {
                    console.log('üñºÔ∏è Image is an object, extracting image_url:', imagePath.image_url);
                    return imagePath.image_url;
                }
                
                // Handle case where imagePath is an object with file_path
                if (imagePath && typeof imagePath === 'object' && imagePath.file_path) {
                    console.log('üñºÔ∏è Image is an object, extracting file_path:', imagePath.file_path);
                    // Remove leading slash if present
                    return imagePath.file_path.startsWith('/') ? imagePath.file_path.substring(1) : imagePath.file_path;
                }
                
                // Handle case where imagePath is a string
                if (imagePath && typeof imagePath === 'string' && imagePath.trim() !== '') {
                    const trimmedPath = imagePath.trim();
                    
                    // Check if image path is relative or absolute
                    if (trimmedPath.startsWith('http') || trimmedPath.startsWith('//')) {
                        return trimmedPath; // Absolute URL
                    } else if (trimmedPath.startsWith('/')) {
                        return trimmedPath; // Root-relative
                    } else if (trimmedPath.startsWith('uploads/')) {
                        return trimmedPath; // Already correct path
                    } else {
                        return `uploads/images/${trimmedPath}`; // Add uploads/images/ prefix
                    }
                }
                
                // No valid image found, return fallback
                console.log('‚ö†Ô∏è No valid image found, using fallback');
                return fallbackPath;
                
            } catch (error) {
                console.error('‚ùå Error resolving image path:', error);
                return fallbackPath;
            }
        }

        // Professional Notification System
        function showNotification(type, title, message, duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            const icon = getNotificationIcon(type);
            
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">
                        <i class="fas ${icon} notification-icon"></i>
                        ${title}
                    </div>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="notification-message">${message}</div>
                <div class="notification-progress"></div>
            `;
            
            container.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto-remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, duration);
            }
        }
        
        function getNotificationIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            return icons[type] || 'fa-info-circle';
        }
        
        // Checkout page functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Content Loaded - Starting checkout initialization');
            
            // Small delay to ensure all elements are ready
            setTimeout(() => {
                // Initialize checkout with product data
                initializeCheckout();
                
                // Show welcome notification
                showNotification('info', 'Welcome to Checkout', 'Please review your order details and complete the form below', 4000);
            }, 100);
            
            // Payment method selection
            const paymentMethods = document.querySelectorAll('.payment-method');
            paymentMethods.forEach(method => {
                method.addEventListener('click', function() {
                    // Remove active class from all methods
                    paymentMethods.forEach(m => m.classList.remove('active'));
                    // Add active class to clicked method
                    this.classList.add('active');
                    // Check the radio input
                    this.querySelector('input').checked = true;
                    
                    // Show/hide COD info
                    if (this.querySelector('input').id === 'cod') {
                        document.getElementById('codInfo').style.display = 'block';
                        document.getElementById('codChargesRow').style.display = 'block'; // Show COD charges
                    } else {
                        document.getElementById('codInfo').style.display = 'none';
                        document.getElementById('codChargesRow').style.display = 'none'; // Hide COD charges
                    }
                    
                    // Update totals
                    updateOrderTotal();
                    
                    // Show payment method change notification
                    const paymentId = this.querySelector('input').id;
                    let paymentType;
                    if (paymentId === 'cod') {
                        paymentType = 'Cash on Delivery';
                    } else if (paymentId === 'razorpay') {
                        paymentType = 'Online Payment';
                    } else {
                        paymentType = 'Online Payment';
                    }
                    showNotification('info', 'Payment Method Changed', `Switched to ${paymentType}`, 3000);
                });
            });
            
            // Form submission
            document.getElementById('checkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('üöÄ Form submitted, processing order...');
                
                // Basic form validation
                const requiredFields = ['firstName', 'lastName', 'email', 'phone', 'address', 'city', 'state', 'zip', 'country'];
                const missingFields = [];
                
                requiredFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (!element || !element.value.trim()) {
                        missingFields.push(field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()));
                    }
                });
                
                if (missingFields.length > 0) {
                    showNotification('warning', 'Form Incomplete', `Please fill in: ${missingFields.join(', ')}`, 5000);
                    return;
                }
                
                // Check if user is logged in
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                if (!currentUser.id) {
                    showNotification('warning', 'Login Required', 'Please login to place an order', 3000);
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 3000);
                    return;
                }
                
                // Show processing notification
                showNotification('info', 'Processing Order', 'Please wait while we process your order...', 0);
                
                // Process the order
                processOrder();
            });
        });

        // Initialize checkout with product data
        function initializeCheckout() {
            console.log('üîÑ Initializing checkout...');
            const urlParams = new URLSearchParams(window.location.search);
            console.log('üìã URL Parameters:', Object.fromEntries(urlParams));
            
            const productData = urlParams.get('product');
            const productsData = urlParams.get('products');
            const cartData = urlParams.get('cart');
            const orderId = urlParams.get('orderId');
            const cartId = urlParams.get('cartId');
            
            console.log('üîç Found parameters:', { productData, productsData, cartData, orderId, cartId });
            
            // Log the raw product data for debugging
            if (productData) {
                console.log('üì¶ Raw product data:', productData);
                try {
                    const decoded = decodeURIComponent(productData);
                    console.log('üîì Decoded product data:', decoded);
                } catch (error) {
                    console.error('‚ùå Error decoding product data:', error);
                }
            }
            
            if (productsData) {
                try {
                    console.log('üì¶ Parsing multiple products data...');
                    const products = JSON.parse(decodeURIComponent(productsData));
                    console.log('‚úÖ Parsed multiple products:', products);
                    displayMultipleProductsInCheckout(products);
                } catch (error) {
                    console.error('‚ùå Error parsing multiple products data:', error);
                    showEmptyState();
                }
            } else if (productData) {
                try {
                    console.log('üì¶ Parsing single product data...');
                    const product = JSON.parse(decodeURIComponent(productData));
                    console.log('‚úÖ Parsed product:', product);
                    displayProductInCheckout(product);
                } catch (error) {
                    console.error('‚ùå Error parsing product data:', error);
                    showEmptyState();
                }
            } else if (cartData) {
                try {
                    console.log('üõí Parsing cart data...');
                    const cart = JSON.parse(decodeURIComponent(cartData));
                    console.log('‚úÖ Parsed cart data:', cart);
                    displayCartInCheckout(cart);
                } catch (error) {
                    console.error('‚ùå Error parsing cart data:', error);
                    showEmptyState();
                }
            } else if (orderId) {
                console.log('üìã Fetching order summary for ID:', orderId);
                fetchOrderSummary(orderId);
            } else if (cartId) {
                console.log('üõí Fetching cart summary for ID:', cartId);
                fetchCartSummary(cartId);
            } else {
                // Check if there are individual product parameters
                const productId = urlParams.get('id');
                const productName = urlParams.get('name');
                const productPrice = urlParams.get('price');
                const productImage = urlParams.get('image');
                const productSize = urlParams.get('size');
                const productQuantity = urlParams.get('quantity');
                
                console.log('üîç Individual parameters:', { productId, productName, productPrice, productImage, productSize, productQuantity });
                
                if (productId && productName && productPrice) {
                    const product = {
                        id: productId,
                        name: productName,
                        price: parseFloat(productPrice),
                        image: productImage || 'uploads/images/1754636223677-118256129.png',
                        size: productSize || 'Standard',
                        quantity: parseInt(productQuantity) || 1
                    };
                    console.log('‚úÖ Created product object:', product);
                    displayProductInCheckout(product);
                } else {
                    console.log('‚ùå Missing required parameters, showing empty state');
                    showEmptyState();
                }
            }
        }

        // Fetch order summary from database
        async function fetchOrderSummary(orderId) {
            try {
                showLoadingState();
                
                const response = await fetch(`/api/orders/${orderId}/summary`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const orderData = await response.json();
                displayOrderSummary(orderData);
            } catch (error) {
                console.error('Error fetching order summary:', error);
                showErrorState('Failed to load order summary. Please try again.');
            }
        }

        // Fetch cart summary from database
        async function fetchCartSummary(cartId) {
            try {
                showLoadingState();
                
                const response = await fetch(`/api/cart/${cartId}/summary`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const cartData = await response.json();
                displayCartSummary(cartData);
            } catch (error) {
                console.error('Error fetching cart summary:', error);
                showErrorState('Failed to load cart summary. Please try again.');
            }
        }

        // Display order summary from database
        function displayOrderSummary(orderData) {
            const orderItemsContainer = document.getElementById('orderItems');
            
            if (!orderData.items || orderData.items.length === 0) {
                showEmptyState();
                return;
            }
            
            let itemsHTML = '';
            let totalSubtotal = 0;
            
            orderData.items.forEach(item => {
                totalSubtotal += item.price * item.quantity;
                
                // Handle image path with proper fallback using utility function
                // Try both item.image (new format) and item.image_url (legacy format)
                const imageSource = item.image || item.image_url;
                const imagePath = resolveImagePath(imageSource);
                
                itemsHTML += `
                    <div class="summary-item">
                        <img src="${imagePath}" 
                             alt="${item.name}" 
                             class="summary-item-image"
                             onerror="this.src='uploads/images/placeholder.svg'">
                        <div class="summary-item-details">
                            <div class="summary-item-title">${item.name}</div>
                            <div class="summary-item-price">‚Çπ${item.price.toLocaleString()}</div>
                            <div>Size: ${item.size || 'Standard'}</div>
                            <div>Qty: ${item.quantity}</div>
                        </div>
                    </div>
                `;
            });
            
            orderItemsContainer.innerHTML = itemsHTML;
            
            // Update totals
            updateOrderTotalsFromData(totalSubtotal, orderData.shipping || 0, orderData.tax || 0);
        }

        // Display cart summary from database
        function displayCartSummary(cartData) {
            const orderItemsContainer = document.getElementById('orderItems');
            
            if (!cartData.items || cartData.items.length === 0) {
                showEmptyState();
                return;
            }
            
            let itemsHTML = '';
            let totalSubtotal = 0;
            
            cartData.items.forEach(item => {
                totalSubtotal += item.price * item.quantity;
                
                // Handle image path with proper fallback using utility function
                // Try both item.image (new format) and item.image_url (legacy format)
                const imageSource = item.image || item.image_url;
                const imagePath = resolveImagePath(imageSource);
                
                itemsHTML += `
                    <div class="summary-item">
                        <img src="${imagePath}" 
                             alt="${item.name}" 
                             class="summary-item-image"
                             onerror="this.src='uploads/images/placeholder.svg'">
                        <div class="summary-item-details">
                            <div class="summary-item-title">${item.name}</div>
                            <div class="summary-item-price">‚Çπ${item.price.toLocaleString()}</div>
                            <div>Size: ${item.size || 'Standard'}</div>
                            <div>Qty: ${item.quantity}</div>
                        </div>
                    </div>
                `;
            });
            
            orderItemsContainer.innerHTML = itemsHTML;
            
            // Update totals
            updateOrderTotalsFromCart(cartData);
        }

        // Update order totals from database data
        function updateOrderTotalsFromData(subtotal, shipping, tax) {
            const total = subtotal + shipping; // No tax calculation - prices are inclusive
            
            document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toLocaleString()}`;
            document.getElementById('shipping').textContent = shipping === 0 ? 'Free' : `‚Çπ${shipping.toLocaleString()}`;
            document.getElementById('total').textContent = `‚Çπ${total.toLocaleString()}`;
        }

        // Update order totals from cart data
        function updateOrderTotalsFromCart(cart) {
            console.log('üí∞ Updating order totals from cart:', cart);
            
            const subtotal = cart.subtotal || cart.items.reduce((total, item) => total + (item.price * item.quantity), 0);
            const total = cart.total || subtotal; // No tax calculation - prices are inclusive
            
            console.log('üìä Cart totals:', { subtotal, total });
            
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('total');
            
            if (subtotalElement && totalElement) {
                subtotalElement.textContent = `‚Çπ${subtotal.toLocaleString()}`;
                totalElement.textContent = `‚Çπ${total.toLocaleString()}`;
                console.log('‚úÖ Cart totals updated successfully');
            } else {
                console.error('‚ùå Could not find total elements:', { subtotalElement, totalElement });
            }
        }

        // Update order total including COD charges if applicable
        function updateOrderTotal() {
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('total');
            const codChargesRow = document.getElementById('codChargesRow');
            const shippingElement = document.getElementById('shipping');
            
            if (!subtotalElement || !totalElement) return;
            
            // Get current subtotal
            const subtotalText = subtotalElement.textContent;
            const subtotal = parseFloat(subtotalText.replace('‚Çπ', '').replace(',', '')) || 0;
            
            // Check if COD is selected
            const codSelected = document.querySelector('input[name="payment"]:checked').id === 'cod';
            
            let total = subtotal;
            
            if (codSelected) {
                // Add COD delivery charges
                total += 200;
                if (codChargesRow) {
                    codChargesRow.style.display = 'block';
                }
                // Update shipping text for COD
                if (shippingElement) {
                    shippingElement.textContent = '‚Çπ200 (Advance)';
                }
            } else {
                // Hide COD charges for other payment methods
                if (codChargesRow) {
                    codChargesRow.style.display = 'none';
                }
                // Update shipping text for UPI (Free Delivery)
                if (shippingElement) {
                    shippingElement.textContent = 'Free Delivery';
                }
            }
            
            // Update total display
            totalElement.textContent = `‚Çπ${total.toLocaleString()}`;
            
            console.log('üí∞ Updated order total:', { subtotal, total, codSelected });
        }

        // Show loading state
        function showLoadingState() {
            const orderItemsContainer = document.getElementById('orderItems');
            orderItemsContainer.innerHTML = `
                <div class="loading-summary">
                    <div class="loading-spinner"></div>
                    <p>Loading order summary...</p>
                </div>
            `;
        }

        // Show error state
        function showErrorState(message) {
            const orderItemsContainer = document.getElementById('orderItems');
            orderItemsContainer.innerHTML = `
                <div class="empty-summary">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                    <a href="collections.html" class="btn">Continue Shopping</a>
                </div>
            `;
            
            // Reset totals
            document.getElementById('subtotal').textContent = '‚Çπ0';
            document.getElementById('total').textContent = '‚Çπ0';
        }

        // Display product in checkout summary
        function displayProductInCheckout(product) {
            console.log('üéØ Displaying product in checkout:', product);
            
            const orderItemsContainer = document.getElementById('orderItems');
            if (!orderItemsContainer) {
                console.error('‚ùå Order items container not found!');
                return;
            }
            
            // Validate product data
            if (!product || typeof product !== 'object') {
                console.error('‚ùå Invalid product data:', product);
                showEmptyState();
                return;
            }
            
            // Handle image path with proper fallback using utility function
            console.log('üñºÔ∏è Processing image data:', {
                image: product.image,
                imageType: typeof product.image,
                hasImage: !!product.image
            });
            
            const imagePath = resolveImagePath(product.image);
            console.log('üñºÔ∏è Image path resolved:', imagePath);
            
            // Create product HTML with error handling for image
            const productHTML = `
                <div class="summary-item">
                    <img src="${imagePath}" 
                         alt="${product.name}" 
                         class="summary-item-image"
                         onerror="this.src='uploads/images/placeholder.svg'">
                    <div class="summary-item-details">
                        <div class="summary-item-title">${product.name}</div>
                        <div class="summary-item-price">‚Çπ${product.price.toLocaleString()}</div>
                        <div>Size: ${product.size}</div>
                        <div>Qty: ${product.quantity}</div>
                    </div>
                </div>
            `;
            
            console.log('üìù Generated HTML:', productHTML);
            orderItemsContainer.innerHTML = productHTML;
            console.log('‚úÖ Product HTML inserted successfully');
            
            // Update totals
            updateOrderTotals(product);
            
            // Show edit order button
            showEditOrderButton();
        }

        // Display multiple products in checkout summary
        function displayMultipleProductsInCheckout(products) {
            console.log('üéØ Displaying multiple products in checkout:', products);
            
            const orderItemsContainer = document.getElementById('orderItems');
            if (!orderItemsContainer) {
                console.error('‚ùå Order items container not found!');
                return;
            }
            
            if (!Array.isArray(products) || products.length === 0) {
                showEmptyState();
                return;
            }
            
            let productsHTML = '';
            let totalSubtotal = 0;
            
            products.forEach(product => {
                const itemTotal = product.price * product.quantity;
                totalSubtotal += itemTotal;
                
                // Handle image path with proper fallback using utility function
                const imagePath = resolveImagePath(product.image);
                
                productsHTML += `
                    <div class="summary-item">
                        <img src="${imagePath}" 
                             alt="${product.name}" 
                             class="summary-item-image"
                             onerror="this.src='uploads/images/placeholder.svg'">
                        <div class="summary-item-details">
                            <div class="summary-item-title">${product.name}</div>
                            <div class="summary-item-price">‚Çπ${product.price.toLocaleString()}</div>
                            <div>Size: ${product.size || 'Standard'}</div>
                            <div>Qty: ${product.quantity}</div>
                        </div>
                    </div>
                `;
            });
            
            console.log('üìù Generated multiple products HTML');
            orderItemsContainer.innerHTML = productsHTML;
            console.log('‚úÖ Multiple products HTML inserted successfully');
            
            // Update totals for multiple products
            updateOrderTotalsForMultipleProducts(products, totalSubtotal);
            
            // Show edit order button
            showEditOrderButton();
        }

        // Display cart items in checkout summary
        function displayCartInCheckout(cart) {
            console.log('üõí Displaying cart in checkout:', cart);
            
            const orderItemsContainer = document.getElementById('orderItems');
            if (!orderItemsContainer) {
                console.error('‚ùå Order items container not found!');
                return;
            }
            
            if (!cart.items || !Array.isArray(cart.items) || cart.items.length === 0) {
                showEmptyState();
                return;
            }
            
            let cartHTML = '';
            
            cart.items.forEach(item => {
                // Handle image path with proper fallback using utility function
                // Try both item.image (new format) and item.image_url (legacy format)
                const imageSource = item.image || item.image_url;
                const imagePath = resolveImagePath(imageSource);
                
                console.log('üñºÔ∏è Cart item image processing:', {
                    itemId: item.id,
                    itemName: item.name,
                    itemImage: item.image,
                    itemImageUrl: item.image_url,
                    selectedSource: imageSource,
                    resolvedPath: imagePath
                });
                
                cartHTML += `
                    <div class="summary-item">
                        <img src="${imagePath}" 
                             alt="${item.name}" 
                             class="summary-item-image"
                             onerror="this.src='uploads/images/placeholder.svg'">
                        <div class="summary-item-details">
                            <div class="summary-item-title">${item.name}</div>
                            <div class="summary-item-price">‚Çπ${item.price.toLocaleString()}</div>
                            <div>Size: ${item.size || 'Standard'}</div>
                            <div>Qty: ${item.quantity}</div>
                        </div>
                    </div>
                `;
            });
            
            console.log('üìù Generated cart HTML');
            orderItemsContainer.innerHTML = cartHTML;
            console.log('‚úÖ Cart HTML inserted successfully');
            
            // Update totals from cart data
            updateOrderTotalsFromCart(cart);
            
            // Show edit order button
            showEditOrderButton();
        }

        // Update order totals
        function updateOrderTotals(product) {
            console.log('üí∞ Updating order totals for product:', product);
            
            const subtotal = product.price * product.quantity;
            const total = subtotal; // No tax calculation - prices are inclusive
            
            console.log('üìä Calculated totals:', { subtotal, total });
            
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('total');
            
            if (subtotalElement && totalElement) {
                subtotalElement.textContent = `‚Çπ${subtotal.toLocaleString()}`;
                totalElement.textContent = `‚Çπ${total.toLocaleString()}`;
                console.log('‚úÖ Totals updated successfully');
            } else {
                console.error('‚ùå Could not find total elements:', { subtotalElement, totalElement });
            }
        }

        // Update order totals for multiple products
        function updateOrderTotalsForMultipleProducts(products, subtotal) {
            console.log('üí∞ Updating order totals for multiple products:', { products, subtotal });
            
            const total = subtotal; // No tax calculation - prices are inclusive
            
            console.log('üìä Calculated totals:', { subtotal, total });
            
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('total');
            
            if (subtotalElement && totalElement) {
                subtotalElement.textContent = `‚Çπ${subtotal.toLocaleString()}`;
                totalElement.textContent = `‚Çπ${total.toLocaleString()}`;
                console.log('‚úÖ Multiple products totals updated successfully');
            } else {
                console.error('‚ùå Could not find total elements:', { subtotalElement, totalElement });
            }
        }

        // Show empty state when no products
        function showEmptyState() {
            const orderItemsContainer = document.getElementById('orderItems');
            orderItemsContainer.innerHTML = `
                <div class="empty-summary">
                    <i class="fas fa-shopping-bag"></i>
                    <p>No products selected for checkout</p>
                    <p>Please add products to your cart or use the Buy Now option</p>
                    <a href="collections.html" class="btn">Continue Shopping</a>
                </div>
            `;
            
            // Reset totals
            document.getElementById('subtotal').textContent = '‚Çπ0';
            document.getElementById('total').textContent = '‚Çπ0';
            
            // Hide edit order button
            hideEditOrderButton();
        }

        // Show edit order button
        function showEditOrderButton() {
            const editOrderBtn = document.getElementById('editOrderBtn');
            const addMoreProductsBtn = document.getElementById('addMoreProductsBtn');
            
            if (editOrderBtn) {
                editOrderBtn.style.display = 'block';
                // Add event listener if not already added
                if (!editOrderBtn.hasAttribute('data-listener-added')) {
                    editOrderBtn.addEventListener('click', editOrder);
                    editOrderBtn.setAttribute('data-listener-added', 'true');
                }
            }
            
            if (addMoreProductsBtn) {
                addMoreProductsBtn.style.display = 'block';
                // Add event listener if not already added
                if (!addMoreProductsBtn.hasAttribute('data-listener-added')) {
                    addMoreProductsBtn.addEventListener('click', addMoreProducts);
                    addMoreProductsBtn.setAttribute('data-listener-added', 'true');
                }
            }
        }

        // Hide edit order button
        function hideEditOrderButton() {
            const editOrderBtn = document.getElementById('editOrderBtn');
            const addMoreProductsBtn = document.getElementById('addMoreProductsBtn');
            
            if (editOrderBtn) {
                editOrderBtn.style.display = 'none';
            }
            
            if (addMoreProductsBtn) {
                addMoreProductsBtn.style.display = 'none';
            }
        }

        // Function to be called from product pages with "Buy Now"
        function buyNow(productData) {
            // Encode product data for URL
            const encodedData = encodeURIComponent(JSON.stringify(productData));
            
            // Redirect to checkout with product data
            window.location.href = `checkout.html?product=${encodedData}`;
        }

        // Function to edit order - go back to product page
        function editOrder() {
            const urlParams = new URLSearchParams(window.location.search);
            const productData = urlParams.get('product');
            const productsData = urlParams.get('products');
            const cartData = urlParams.get('cart');
            
            if (cartData) {
                try {
                    const cart = JSON.parse(decodeURIComponent(cartData));
                    // Redirect back to cart page
                    window.location.href = 'cart.html';
                } catch (error) {
                    console.error('Error parsing cart data for edit:', error);
                    window.location.href = 'cart.html';
                }
            } else if (productData) {
                try {
                    const product = JSON.parse(decodeURIComponent(productData));
                    // Redirect back to product detail page
                    window.location.href = `product-detail.html?id=${product.id}`;
                } catch (error) {
                    console.error('Error parsing product data for edit:', error);
                    window.location.href = 'collections.html';
                }
            } else if (productsData) {
                try {
                const products = JSON.parse(decodeURIComponent(productsData));
                if (products.length > 0) {
                    // Redirect to first product's detail page
                    window.location.href = `product-detail.html?id=${products[0].id}`;
                } else {
                    window.location.href = 'collections.html';
                }
                } catch (error) {
                    console.error('Error parsing products data for edit:', error);
                    window.location.href = 'collections.html';
                }
            } else {
                // No product data, go to collections
                window.location.href = 'collections.html';
            }
        }

        // Function to add more products - go to collections page
        function addMoreProducts() {
            // Store current order data in sessionStorage for when user returns
            const urlParams = new URLSearchParams(window.location.search);
            const productData = urlParams.get('product');
            const productsData = urlParams.get('products');
            const cartData = urlParams.get('cart');
            
            if (cartData) {
                // Store cart data for when user returns
                sessionStorage.setItem('pendingCartData', cartData);
                window.location.href = 'collections.html';
            } else if (productData || productsData) {
                sessionStorage.setItem('pendingCheckoutData', productData || productsData);
                sessionStorage.setItem('pendingCheckoutType', productData ? 'single' : 'multiple');
            }
            
            // Redirect to collections page
            window.location.href = 'collections.html';
        }

        // Process order function
        async function processOrder() {
            try {
                console.log('üîÑ Processing order...');
                
                // Show loading state
                const placeOrderBtn = document.getElementById('placeOrderBtn');
                const btnText = placeOrderBtn.querySelector('.btn-text');
                const btnLoading = placeOrderBtn.querySelector('.btn-loading');
                
                placeOrderBtn.disabled = true;
                btnText.style.display = 'none';
                btnLoading.style.display = 'inline-block';
                
                // Get current user
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                if (!currentUser.id) {
                    throw new Error('User not logged in');
                }
                
                // Get form data
                const formData = {
                    email: document.getElementById('email').value,
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    address: document.getElementById('address').value,
                    apartment: document.getElementById('apartment').value,
                    city: document.getElementById('city').value,
                    country: document.getElementById('country').value,
                    state: document.getElementById('state').value,
                    zip: document.getElementById('zip').value,
                    phone: document.getElementById('phone').value,
                    shipping: document.querySelector('input[name="shipping"]:checked').id,
                    payment: document.querySelector('input[name="payment"]:checked').id
                };
                
                console.log('üìã Form data collected:', formData);
                
                // Validate required fields
                if (!formData.email || !formData.firstName || !formData.lastName || !formData.address || 
                    !formData.city || !formData.country || !formData.state || !formData.zip || !formData.phone) {
                    throw new Error('Please fill in all required fields');
                }
                
                // Get product data from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const productData = urlParams.get('product');
                const productsData = urlParams.get('products');
                const cartData = urlParams.get('cart');
                
                let orderItems = [];
                let totalAmount = 0;
                
                if (productsData) {
                    // Multiple products
                    const products = JSON.parse(decodeURIComponent(productsData));
                    orderItems = products.map(product => ({
                        product_id: parseInt(product.id),
                        quantity: product.quantity || 1,
                        price: parseFloat(product.price)
                    }));
                    totalAmount = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                } else if (productData) {
                    // Single product
                    const product = JSON.parse(decodeURIComponent(productData));
                    orderItems = [{
                        product_id: parseInt(product.id),
                        quantity: product.quantity || 1,
                        price: parseFloat(product.price)
                    }];
                    totalAmount = orderItems[0].price * orderItems[0].quantity;
                } else if (cartData) {
                    // Cart data
                    const cart = JSON.parse(decodeURIComponent(cartData));
                    orderItems = cart.items.map(item => ({
                        product_id: parseInt(item.id),
                        quantity: item.quantity || 1,
                        price: parseFloat(item.price)
                    }));
                    totalAmount = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                } else {
                    throw new Error('No product data found');
                }
                
                // Add shipping cost if express shipping selected
                if (formData.shipping === 'expressShipping') {
                    totalAmount += 250; // Express shipping cost
                }
                
                // Add COD delivery charges if COD payment is selected
                if (formData.payment === 'cod') {
                    totalAmount += 200; // COD delivery charges (advance payment)
                    console.log('üí∞ Added COD delivery charges: ‚Çπ200');
                }
                
                console.log('üì¶ Order items:', orderItems);
                console.log('üí∞ Total amount:', totalAmount);
                
                // Prepare shipping address
                const shippingAddress = `${formData.firstName} ${formData.lastName}\n${formData.address}${formData.apartment ? ', ' + formData.apartment : ''}\n${formData.city}, ${formData.state} ${formData.zip}\n${formData.country}\nPhone: ${formData.phone}`;
                
                // Handle payment method
                if (formData.payment === 'razorpay') {
                    // Process online payment with Razorpay
                    await processRazorpayPayment(formData, orderItems, totalAmount, shippingAddress, currentUser);
                } else if (formData.payment === 'cod') {
                    // Process COD order directly
                    await processCODOrder(formData, orderItems, totalAmount, shippingAddress, currentUser);
                } else {
                    throw new Error('Invalid payment method selected');
                }
                
            } catch (error) {
                console.error('‚ùå Error processing order:', error);
                
                // Remove the processing notification
                const processingNotifications = document.querySelectorAll('.notification.info');
                processingNotifications.forEach(notification => notification.remove());
                
                showNotification('error', 'Order Failed', `Error placing order: ${error.message}`, 8000);
            } finally {
                // Reset loading state
                const placeOrderBtn = document.getElementById('placeOrderBtn');
                const btnText = placeOrderBtn.querySelector('.btn-text');
                const btnLoading = placeOrderBtn.querySelector('.btn-loading');
                
                placeOrderBtn.disabled = false;
                btnText.style.display = 'inline-block';
                btnLoading.style.display = 'none';
            }
        }

        // Process Razorpay payment
        async function processRazorpayPayment(formData, orderItems, totalAmount, shippingAddress, currentUser) {
            try {
                console.log('üí≥ Initiating Razorpay payment...');
                
                // Create order in backend first
                const orderResponse = await fetch(`${API_BASE_URL}/payment/create-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: totalAmount,
                        currency: 'INR',
                        receipt: `order_${Date.now()}`,
                        notes: {
                            customer_name: `${formData.firstName} ${formData.lastName}`,
                            customer_email: formData.email,
                            customer_phone: formData.phone
                        }
                    })
                });
                
                if (!orderResponse.ok) {
                    const errorData = await orderResponse.json();
                    throw new Error(errorData.error || 'Failed to create payment order');
                }
                
                const orderData = await orderResponse.json();
                console.log('‚úÖ Razorpay order created:', orderData);
                
                // Check if in demo mode
                if (orderData.demo_mode || orderData.fallback_mode) {
                    console.log('‚ö†Ô∏è Demo/Fallback mode detected - simulating payment');
                    
                    // Show demo payment notification
                    showNotification('info', 'Demo Mode', 'This is a demo payment. In production, real Razorpay credentials are needed.', 5000);
                    
                    // Simulate payment success after 2 seconds
                    setTimeout(async () => {
                        const mockPaymentResponse = {
                            razorpay_order_id: orderData.order.id,
                            razorpay_payment_id: 'pay_demo_' + Date.now(),
                            razorpay_signature: 'demo_signature_' + Date.now()
                        };
                        
                        console.log('üí≥ Simulated payment successful:', mockPaymentResponse);
                        await handlePaymentSuccess(mockPaymentResponse, formData, orderItems, totalAmount, shippingAddress, currentUser);
                    }, 2000);
                    
                    return;
                }
                
                // Configure Razorpay options for real payments
                const options = {
                    key: orderData.key_id,
                    amount: orderData.order.amount,
                    currency: orderData.order.currency,
                    name: 'Urban Nucleus',
                    description: 'Premium Fashion & Lifestyle',
                    order_id: orderData.order.id,
                    prefill: {
                        name: `${formData.firstName} ${formData.lastName}`,
                        email: formData.email,
                        contact: formData.phone
                    },
                    theme: {
                        color: '#000000'
                    },
                    handler: async function (response) {
                        console.log('üí≥ Payment successful:', response);
                        await handlePaymentSuccess(response, formData, orderItems, totalAmount, shippingAddress, currentUser);
                    },
                    modal: {
                        ondismiss: function() {
                            console.log('üí≥ Payment cancelled by user');
                            // Reset loading state
                            resetOrderButton();
                            showNotification('warning', 'Payment Cancelled', 'You cancelled the payment. Please try again.', 5000);
                        }
                    }
                };
                
                // Open Razorpay checkout
                const rzp = new Razorpay(options);
                rzp.open();
                
                // Hide processing notification as Razorpay modal is now open
                const processingNotifications = document.querySelectorAll('.notification.info');
                processingNotifications.forEach(notification => notification.remove());
                
            } catch (error) {
                console.error('‚ùå Error processing Razorpay payment:', error);
                throw error;
            }
        }

        // Handle successful payment
        async function handlePaymentSuccess(paymentResponse, formData, orderItems, totalAmount, shippingAddress, currentUser) {
            try {
                console.log('‚úÖ Verifying payment...');
                showNotification('info', 'Verifying Payment', 'Please wait while we verify your payment...', 0);
                
                // Prepare order data for backend
                const orderData = {
                    user_id: currentUser.id,
                    items: orderItems,
                    total_amount: totalAmount,
                    shipping_address: shippingAddress,
                    payment_method: 'razorpay',
                    payment_amount: totalAmount,
                    payment_currency: 'INR'
                };
                
                // Create order in database
                const orderResponse = await fetch(`${API_BASE_URL}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (!orderResponse.ok) {
                    const errorData = await orderResponse.json();
                    throw new Error(errorData.error || 'Failed to create order');
                }
                
                const orderResult = await orderResponse.json();
                console.log('‚úÖ Order created in database:', orderResult);
                
                // Verify payment with backend
                const verifyResponse = await fetch(`${API_BASE_URL}/payment/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        razorpay_order_id: paymentResponse.razorpay_order_id,
                        razorpay_payment_id: paymentResponse.razorpay_payment_id,
                        razorpay_signature: paymentResponse.razorpay_signature,
                        order_data: { order_id: orderResult.order_id }
                    })
                });
                
                if (!verifyResponse.ok) {
                    const errorData = await verifyResponse.json();
                    throw new Error(errorData.error || 'Payment verification failed');
                }
                
                const verifyResult = await verifyResponse.json();
                console.log('‚úÖ Payment verified successfully:', verifyResult);
                
                // Store order data in sessionStorage for order confirmation page
                sessionStorage.setItem('lastOrderData', JSON.stringify({
                    ...orderData,
                    order_id: orderResult.order_id,
                    payment_verified: true,
                    razorpay_payment_id: paymentResponse.razorpay_payment_id
                }));
                
                // Remove verification notification
                const verificationNotifications = document.querySelectorAll('.notification.info');
                verificationNotifications.forEach(notification => notification.remove());
                
                // Show success notification
                showNotification('success', 'Payment Successful!', `Your order has been confirmed. Order ID: #${orderResult.order_id}`, 8000);
                
                // Clear cart if order was from cart
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('cart')) {
                    localStorage.removeItem('cart');
                    console.log('üõí Cart cleared after successful order');
                }
                
                // Redirect to order confirmation after a short delay
                setTimeout(() => {
                    window.location.href = 'order-confirmation.html';
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Error handling payment success:', error);
                
                // Remove verification notification
                const verificationNotifications = document.querySelectorAll('.notification.info');
                verificationNotifications.forEach(notification => notification.remove());
                
                // Show error notification
                showNotification('error', 'Payment Verification Failed', 'Your payment was successful but order verification failed. Please contact support.', 10000);
                
                // Reset loading state
                resetOrderButton();
            }
        }

        // Process COD order (existing logic)
        async function processCODOrder(formData, orderItems, totalAmount, shippingAddress, currentUser) {
            try {
                console.log('üíµ Processing COD order...');
                
                // Prepare order data for backend
                const orderData = {
                    user_id: currentUser.id,
                    items: orderItems,
                    total_amount: totalAmount,
                    shipping_address: shippingAddress,
                    payment_method: 'cod',
                    is_cod: true,
                    cod_advance_paid: 200,
                    cod_remaining_amount: totalAmount - 200,
                    payment_amount: 200, // Only advance payment
                    payment_currency: 'INR'
                };
                
                console.log('üì§ Sending COD order to backend:', orderData);
                
                // Call backend API
                const response = await fetch(`${API_BASE_URL}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to place order');
                }
                
                const result = await response.json();
                console.log('‚úÖ COD order placed successfully:', result);
                
                // Store order data in sessionStorage for order confirmation page
                sessionStorage.setItem('lastOrderData', JSON.stringify({
                    ...orderData,
                    order_id: result.order_id
                }));
                
                // Remove the processing notification
                const processingNotifications = document.querySelectorAll('.notification.info');
                processingNotifications.forEach(notification => notification.remove());
                
                // Show success notification
                showNotification('success', 'Order Placed Successfully!', `Your COD order has been confirmed. Order ID: #${result.order_id}`, 8000);
                
                // Clear cart if order was from cart
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('cart')) {
                    localStorage.removeItem('cart');
                    console.log('üõí Cart cleared after successful COD order');
                }
                
                // Redirect to order confirmation after a short delay
                setTimeout(() => {
                    window.location.href = 'order-confirmation.html';
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Error processing COD order:', error);
                throw error;
            }
        }

        // Reset order button to original state
        function resetOrderButton() {
            const placeOrderBtn = document.getElementById('placeOrderBtn');
            const btnText = placeOrderBtn.querySelector('.btn-text');
            const btnLoading = placeOrderBtn.querySelector('.btn-loading');
            
            placeOrderBtn.disabled = false;
            btnText.style.display = 'inline-block';
            btnLoading.style.display = 'none';
        }
        
        // Function to be called from product pages with individual parameters
        function buyNowSimple(id, name, price, image, size, quantity) {
            const params = new URLSearchParams({
                id: id,
                name: name,
                price: price,
                image: image || 'uploads/images/1754636223677-118256129.png',
                size: size || 'Standard',
                quantity: quantity || 1
            });
            
            window.location.href = `checkout.html?${params.toString()}`;
        }

        // Fallback initialization - call initializeCheckout if not already called
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeCheckout);
        } else {
            // DOM is already loaded
            setTimeout(initializeCheckout, 100);
        }


    </script>

    <!-- Search Functionality -->
    <!-- Authentication State Management -->
    <script>
        // Check login state and update header
        function checkLoginState() {
            const currentUser = localStorage.getItem('currentUser');
            const headerIcons = document.querySelector('.header-icons');
            
            if (!headerIcons) return;
            
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    headerIcons.innerHTML = `
                        <a href="profile.html" class="user-info">
                            <i class="fas fa-user"></i> 
                            <span class="user-name">${user.username || user.email}</span>
                        </a>
                        <a href="#" onclick="logout()" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                        <button type="button" id="searchBtn" class="search-button-header">
                            <i class="fas fa-search"></i>
                        </button>
                        <a href="cart.html" class="cart-icon"><i class="fas fa-shopping-bag"></i><span class="cart-count">0</span></a>
                    `;
                    updateCartCountFromStorage();
                } catch (error) {
                    localStorage.removeItem('currentUser');
                    checkLoginState();
                }
            } else {
                headerIcons.innerHTML = `
                    <a href="login.html"><i class="fas fa-user"></i> Login</a>
                    <a href="signup.html"><i class="fas fa-user-plus"></i> Sign Up</a>
                    <button type="button" id="searchBtn" class="search-button-header">
                        <i class="fas fa-search"></i>
                    </button>
                    <a href="cart.html" class="cart-icon"><i class="fas fa-shopping-bag"></i><span class="cart-count">0</span></a>
                `;
                updateCartCountFromStorage();
            }
        }
        
        function updateCartCountFromStorage() {
            try {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.querySelectorAll('.cart-count').forEach(countElement => {
                    countElement.textContent = totalItems;
                });
            } catch (error) {
                document.querySelectorAll('.cart-count').forEach(countElement => {
                    countElement.textContent = '0';
                });
            }
        }
        
        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('authToken');
            checkLoginState();
            alert('Logged out successfully');
        }

        document.addEventListener('DOMContentLoaded', function() {
            checkLoginState();
            
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) checkLoginState();
            });
            
            window.addEventListener('focus', function() {
                checkLoginState();
            });
        });
    </script>

    <script>
        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Initializing search functionality...');
            
            // Get elements
            const searchBtns = document.querySelectorAll('#searchBtn');
            const searchModal = document.getElementById('searchModal');
            const closeSearchBtn = document.getElementById('closeSearchBtn');
            const searchInput = document.getElementById('searchInput');
            const performSearchBtn = document.getElementById('performSearchBtn');
            const searchResultsContainer = document.getElementById('searchResultsContainer');
            const suggestionButtons = document.querySelectorAll('.suggestion-btn');
            
            // Debug: Check if elements exist
            console.log('üîç Search elements found:', {
                searchBtns: searchBtns.length,
                searchModal: !!searchModal,
                closeSearchBtn: !!closeSearchBtn
            });
            
            // Add click handlers to all search buttons
            searchBtns.forEach((searchBtn, index) => {
                if (searchBtn) {
                    searchBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log(`üîç Search button ${index + 1} clicked! Opening modal...`);
                        
                        if (searchModal) {
                            searchModal.style.display = 'flex';
                            searchModal.classList.add('show');
                            console.log('üîç Modal should be visible now');
                            
                            setTimeout(() => {
                                if (searchInput) {
                                    searchInput.focus();
                                }
                            }, 100);
                        } else {
                            console.error('‚ùå Search modal not found!');
                        }
                    });
                    
                    console.log(`üîç Event listener added to search button ${index + 1}`);
                }
            });
            
            // Close search modal
            if (closeSearchBtn && searchModal) {
                closeSearchBtn.addEventListener('click', function() {
                    console.log('üîç Closing search modal...');
                    searchModal.classList.remove('show');
                    setTimeout(() => {
                        searchModal.style.display = 'none';
                    }, 300);
                });
            }
            
            // Close modal when clicking outside
            if (searchModal) {
                searchModal.addEventListener('click', function(e) {
                    if (e.target === searchModal) {
                        closeSearchBtn.click();
                    }
                });
            }
            
            // Perform search function
            async function performSearch(query) {
                if (!query || query.trim() === '') {
                    return;
                }
                
                console.log('üîç Performing search for:', query);
                
                try {
                    const response = await fetch(`/products/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const results = await response.json();
                    console.log('üîç Search results:', results);
                    displaySearchResults(results);
                } catch (error) {
                    console.error('‚ùå Search error:', error);
                    searchResultsContainer.innerHTML = `
                        <div class="search-no-results">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ff6b6b; margin-bottom: 20px;"></i>
                            <h3>Search Error</h3>
                            <p>Unable to perform search. Please try again.</p>
                        </div>
                    `;
                }
            }
            
            // Display search results
            function displaySearchResults(results) {
                if (!results || results.length === 0) {
                    searchResultsContainer.innerHTML = `
                        <div class="search-no-results">
                            <i class="fas fa-search" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 20px;"></i>
                            <h3>No products found</h3>
                            <p>Try different keywords or browse our collections.</p>
                        </div>
                    `;
                    return;
                }
                
                const resultsHTML = results.map(product => `
                    <div class="search-result-item" onclick="window.location.href='product-detail.html?id=${product.id}'">
                        <img src="${product.image_url || '/images/placeholder.jpg'}" alt="${product.name}" class="search-result-image" loading="lazy">
                        <div class="search-result-info">
                            <div class="search-result-name">${product.name}</div>
                            <div class="search-result-price">‚Çπ${product.price}</div>
                        </div>
                    </div>
                `).join('');
                
                searchResultsContainer.innerHTML = `
                    <div class="search-results-grid">
                        ${resultsHTML}
                    </div>
                `;
            }
            
            // Search input events
            if (searchInput && performSearchBtn) {
                performSearchBtn.addEventListener('click', function() {
                    performSearch(searchInput.value);
                });
                
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch(searchInput.value);
                    }
                });
            }
            
            // Suggestion buttons
            suggestionButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const query = this.getAttribute('data-query');
                    if (searchInput) {
                        searchInput.value = query;
                    }
                    performSearch(query);
                });
            });
        });
    </script>
</body>
</html>